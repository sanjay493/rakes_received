{% extends "base.html" %}
{% block content %}

<!-- Unit Selection Buttons -->
<div class="card">
    <h3>Select Unit (Destination Station)</h3>
    <div class="unit-buttons">
        {% for unit in sttn_tos %}
        <a href="?unit={{ unit }}" class="unit-btn {% if unit == selected_unit %}active{% endif %}">
            {{ unit }}
        </a>
        {% endfor %}
    </div>
</div>

<!-- Filters & Analysis -->
<div class="card">
    <h3>Filters & Analysis for {{ selected_unit }}</h3>

    <form method="POST" action="/dashboard">
        <input type="hidden" name="unit" value="{{ selected_unit }}">

        <div class="filter-grid">
            <div>
                <label>Source Station</label>
                <select name="sttn_from">
                    <option value="">All Sources</option>
                    {% for s in sttn_froms %}
                    <option value="{{ s }}" {% if s == selected_sttn_from %}selected{% endif %}>{{ s }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label>Commodity</label>
                <select name="commodity">
                    <option value="">All Commodities</option>
                    {% for c in commodities %}
                    <option value="{{ c }}" {% if c == selected_commodity %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label>Rake Type</label>
                <select name="rake_type">
                    <option value="">All Rake Types</option>
                    {% for r in rake_types %}
                    <option value="{{ r }}" {% if r == selected_rake_type %}selected{% endif %}>{{ r }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label>Analysis Period</label>
                <select name="analysis_type" required>
                    <option value="last30days" {% if analysis_type == 'last30days' %}selected{% endif %}>Last 30 Days (Daily)</option>
                    <option value="weekly" {% if analysis_type == 'weekly' %}selected{% endif %}>Weekly Average (Last 3 Months)</option>
                    <option value="fortnightly" {% if analysis_type == 'fortnightly' %}selected{% endif %}>Fortnightly Average (Last 4 Months)</option>
                    <option value="monthly" {% if analysis_type == 'monthly' %}selected{% endif %}>Monthly Average (Last Year)</option>
                </select>
            </div>
        </div>

        <br>
        <div class="button-group">
            <button type="submit" class="btn-primary">Run Analysis</button>
            <button type="submit" formaction="/export" formmethod="POST" class="btn-secondary">Download CSV</button>
        </div>
    </form>
</div>

<!-- Graph Display -->
{% if graph_html %}
<div class="graph-box">
    {{ graph_html | safe }}
</div>
{% endif %}

{% endblock %}
